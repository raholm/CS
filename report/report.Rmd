---
title: "Computational Statistics"
subtitle: Lab 5
author: "Emil K Svensson and Rasmus Holm"
date: '`r Sys.Date()`'
output:
    pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Question 1


## 1.1

```{r}
library(ggplot2)
library(boot)
```

```{r}
lottery <- read.csv("../data/lottery.csv", sep=";")
```

```{r}
data <- data.frame(x=lottery$Day_of_year, y=lottery$Draft_No)

ggplot() +
    geom_point(data=data,
               aes(x=x, y=y))
```

From the plot above the data definitely looks random.

## 1.2

```{r}
loessfit <- loess(y ~ x, data=data)
data$pred <- predict(loessfit, data$x)

ggplot(data=data) +
    geom_point(aes(x=x, y=y), color="red") +
    geom_line(aes(x=x, y=pred), color="blue")
```

The line is not completely straight so something might be suspicious about the data.

## 1.3

```{r}
teststat <- function(model) {
    function(data) {
        xa <- data$x[which.min(data$y)]
        xb <- data$x[which.max(data$y)]

        ya <- predict(model, xa)
        yb <- predict(model, xb)

        (yb - ya) / (xb - xa)
    }
}

teststat_boot <- function(data, idx, stat) {
    data <- data[idx,]
    stat(data)
}
```

```{r}
B <- 2000

set.seed(123456)
npboot <- boot(data=data, statistic=teststat_boot, R=B, stat=teststat(loessfit))
```

```{r}
## Two-sided p-value?
sum(npboot$t >= 0) / B
```

```{r}
hist(npboot$t)
```

## 1.4

```{r}
teststat_permutation<- function(data, B, stat) {
    n <- nrow(data)

    statistics <- rep(0, B)
    for (b in 1:B) {
        newdata <- data.frame(x=data$x, y=sample(data$y, n))
        statistics[b] <- stat(newdata)
    }

    sum(statistics >= 0) / B
}

set.seed(123456)
teststat_permutation(data, B, teststat(loessfit))
```

## 1.5

```{r}
genranddata <- function(x, alpha) {
    data.frame(x=x, y=pmax(0, pmin(alpha * x + rnorm(length(x), mean=183, sd=10), 366)))
}

alphas <- seq(0.1, 10, by=0.1)
pvalues <- rep(0, length(alphas))

set.seed(123456)

for (i in 1:length(alphas)) {
    newdata <- genranddata(data$x, alphas[i])
    pvalues[i] <- teststat_permutation(newdata, 200, teststat(loessfit))
}

plot(pvalues)
```

```{r}
print(sum(pvalues <= 0.05))
```

\newpage

## Question 2

## 2.1

```{r}
price <- read.csv("../data/prices1.csv", sep=";")
mean(price$Price)
```

```{r}
hist(price$Price)
```

Looks like a Gamma distribution.

## 2.2

## 2.3

## 2.4
